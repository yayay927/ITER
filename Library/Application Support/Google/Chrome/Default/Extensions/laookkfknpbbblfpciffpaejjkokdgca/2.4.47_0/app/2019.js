(self.webpackChunkmomentum_extension=self.webpackChunkmomentum_extension||[]).push([[2019],{1642:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});const a={props:{viewManager:{type:Object,required:!0}},created(){var e,t;this.viewManager.setActiveBodyComponentInstance(this),this._viewId=this.viewManager.activeViewId,this.viewManager.$on("viewOpened:"+this._viewId,this._afterEnterWrapper),this.viewManager.$on("viewClosed:"+this._viewId,this._afterLeaveWrapper),null===(e=this.viewManager.views[this._viewId])||void 0===e||null===(t=e.beforeEnter)||void 0===t||t.call(e),this.beforeEnter()},destroyed(){this.viewManager.$emit("resolveShowView:"+this._viewId)},methods:{beforeEnter(){},afterEnter(){},beforeLeave(){},afterLeave(){},_afterLeaveWrapper(){var e,t;null===(e=this.viewManager.views[this._viewId])||void 0===e||null===(t=e.afterLeave)||void 0===t||t.call(e),this.afterLeave(),this._removeListeners()},_afterEnterWrapper(){var e,t;null===(e=this.viewManager.views[this._viewId])||void 0===e||null===(t=e.afterEnter)||void 0===t||t.call(e),this.afterEnter()},_removeListeners(){this.viewManager.$off("viewClosed:"+this._viewId,this._afterLeaveWrapper),this.viewManager.$off("viewOpened:"+this._viewId,this._afterEnterWrapper)}}}},3273:(e,t,s)=>{(e.exports=s(3645)(!1)).push([e.id,"\n.modal-form[data-v-3db61620] { display: flex; flex-direction: column;\n}\n.button.add-margin-bottom[data-v-3db61620] { margin-bottom: 20px;\n}\n.button.button-save-secondary[data-v-3db61620] { min-width: auto; padding: 15px 15px 13px; background: none; color: var(--color-active);\n}\n.button.button-save-secondary[data-v-3db61620]:hover { box-shadow: unset;\n}\n.form-message[data-v-3db61620] { margin-bottom: 20px;\n}\n",""])},8102:(e,t,s)=>{(e.exports=s(3645)(!1)).push([e.id,"\n.form-message[data-v-fdde5fde] { width: 100%; margin-top: var(--form-element-margin); position: relative; z-index: 1; display: block; font-size: 0.9375rem; line-height: 1.4; user-select: text;\n}\n.form-message.success[data-v-fdde5fde] { color: var(--color-form-success);\n}\n.form-message.warning[data-v-fdde5fde] { color: var(--color-form-warning);\n}\n.form-message .form-message-label[data-v-fdde5fde] { display: flex; user-select: text;}\n.form-message .form-message-label img[data-v-fdde5fde] { width: 16px; margin-bottom: -2px; margin-right: 5px;\n}\n\n",""])},2019:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"modal-form",on:{submit:function(e){e.preventDefault()}}},[e._l(e.fieldsToRender,(function(t,a){return s("edit-field",{key:a,ref:"newProps",refInFor:!0,attrs:{"auto-focus":!a,field:t,"view-manager":e.viewManager,"field-warnings":e.fieldWarnings,"component-field-warnings":e.componentFieldWarnings},on:{"clear-warnings":e.clearWarnings}})})),e._v(" "),s("transition",{attrs:{name:"fade",mode:"out-in"}},[e.error?s("form-message",{attrs:{message:e.error,error:!!e.error}}):e._e()],1),e._v(" "),s("div",{staticClass:"save-button-container"},[s("button",{staticClass:"button button-primary button-save",attrs:{disabled:e.saving||e.activeItem.disableSave,type:"button","data-test":"submit-button"},on:{click:function(t){return e.saveItem(null,!e.viewManager.activeItem.canSaveAsDraft&&null)}}},[e._v(e._s(e.buttonText))]),e._v(" "),e.viewManager.activeItem.canSaveAsDraft?s("button",{staticClass:"button button-save-secondary",attrs:{disabled:e.saving,type:"button","data-test":"submit-button"},on:{click:function(t){return e.saveItem(null,!0)}}},[e._v("Save as draft")]):e._e()])],2)])};a._withStripped=!0;var i=s(931),n=s(4333);const r={maxLength:(e,t)=>e.validate.maxLength>=t[e.name].length},o={maxLength:n.Qj.MAX_INPUT_LENGTH_EXCEEDED};var d=s(3586),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:["form-message",{warning:e.error}],attrs:{"data-test":e.testAttribute||"form-message"}},[a("span",{staticClass:"form-message-label"},[a("span",{staticClass:"form-message-icon"},[e.error?a("span",[a("inline-svg",{staticClass:"icon icon-error",attrs:{src:s(6325)}})],1):e._e()]),e._v(" "),a("span",{staticClass:"form-message-text"},[e._t("default",[e._v(e._s(e.message))]),e._v(" "),e.contactUs?a("span",[e._v(" Please try again or "),a("a",{attrs:{href:"https://momentumdash.com/contact"}},[e._v("contact us")]),e._v(".")]):e._e()],2)])])};l._withStripped=!0;const h={name:"FormMessage",props:{error:{type:Boolean,default:!1},message:{type:String,default:""},testAttribute:{type:String,default:""},contactUs:{type:Boolean,default:!1}}};s(1685);var v=s(1900),c=(0,v.Z)(h,l,[],!1,null,"fdde5fde",null);c.options.__file="source/addins-vue/shared_components/FormMessage.vue";const g=c.exports;var f=s(1642);const u={name:"EditForm",components:{EditField:d.Z,FormMessage:g},mixins:[f.Z],props:{addButtonText:{type:String,default:"Add"},addButtonLoadingText:{type:String,default:"Adding…"},saveButtonText:{type:String,default:"Save"},saveButtonLoadingText:{type:String,default:"Saving…"},suppressFlashMessages:{type:Boolean,default:!1}},data:()=>({defaultError:"",error:"",saving:!1,fieldWarnings:[],componentFieldWarnings:[]}),computed:{manager(){return this.viewManager.manager},adding(){return this.viewManager.adding},fields(){return this.manager.fields},fieldsToRender(){return this.fields.filter((e=>this.shouldRenderField(e,this.editProps)))},buttonText(){return this.saving?this.adding?this.addButtonLoadingText:this.saveButtonLoadingText:this.adding?this.addButtonText:this.saveButtonText},activeItem(){return this.viewManager.activeItem},editProps(){return this.activeItem.editProps}},created(){Object.keys(this.viewManager.editProps).length||this.viewManager.activeItem.copyProperties(),this.clearWarnings(),this.viewManager.$on("showDeleteConf",this.showDeleteConf),i.Z.registerEventListener("editFormEnter","keyup",13,this.saveItem)},destroyed(){i.Z.removeEventListener("editFormEnter","keyup",13),this.viewManager.$off("showDeleteConf",this.showDeleteConf),this.clearWarnings()},methods:{deleteItem(){return this.manager.delete(this.viewManager.activeItem).then((()=>{this.suppressFlashMessages||this.$e.$emit("flashMessage",{message:this.manager.nameCS+" deleted.",icon:"success"})})).catch((e=>{this.error=this.handleError(e)}))},shouldValidateField(e,t){return!(this.adding?e.editingOnly:e.addingOnly)&&!this.isHiddenInForm(e,t)},emptyCheck(){this.componentFieldWarnings=[];let e=!1;for(let t of this.fields)if(this.shouldValidateField(t,this.viewManager.activeItem.editProps)&&m.utils.access(t.required,this.editProps,this.viewManager.activeItem)){const s=m.utils.access(t.requiredComponentFields,this.editProps);s?s.forEach((s=>{(!this.editProps[t.property][s]||"string"==typeof this.editProps[t.property][s]&&this.editProps[t.property][s].trim().length<=0)&&(e=!0,this.fieldWarnings.push(t.property),this.componentFieldWarnings.push(s))})):(null==this.editProps[t.property]||"string"==typeof this.editProps[t.property]&&this.editProps[t.property].trim().length<=0)&&(e=!0,this.fieldWarnings.push(t.property))}return e},validate(){this.componentFieldWarnings=[];let e=!1;for(let t of this.fields)this.shouldValidateField(t,this.viewManager.activeItem.editProps)&&t.validate&&!Object.keys(t.validate).every((e=>{let s=r[e](t,this.editProps);return s||(this.error=o[e]),s}))&&(e=!0,this.fieldWarnings.push(t.property));return e},clearWarnings(){this.error="",this.fieldWarnings=[],this.componentFieldWarnings=[]},revertChanges(){var e,t;null===(e=this.activeItem)||void 0===e||null===(t=e.revertChanges)||void 0===t||t.call(e),this.viewManager.clearItem()},commitChanges(){var e,t;null===(e=this.activeItem)||void 0===e||null===(t=e.commitChanges)||void 0===t||t.call(e),this.viewManager.clearItem(),this.saving=!1},activeItemHasChanges(){return this.activeItem.getChanges&&0!==this.activeItem.getChanges().length||this.activeItem.getSublinkChanges&&0!==this.viewManager.activeItem.getSublinkChanges().length},autoCapitalizeFields(){this.fields.forEach((e=>{const t=this.editProps[e.property];e.autoCapitalize&&t&&(this.editProps[e.property]=m.utils.capitalizeFirstLetter(t))}))},saveItem(e,t){if(this.clearWarnings(),this.saving||this.emptyCheck()||this.validate())return;let s=!e&&this.getSaveConfInfo();if(s)return void this.showSaveConf(s);this.activeItem.canSaveAsDraft&&"boolean"==typeof t&&(this.activeItem.editProps.draft=t);let a=this.adding?"add":"update";"update"!==a||this.activeItemHasChanges()?(this.saving=!0,this.manager[a](this.viewManager.activeItem).then((()=>{this.activeItem.refreshAfterSave&&this.manager.refresh(),this.viewManager.showView("default",{doNotBlock:!0,afterLeave:()=>{this.autoCapitalizeFields(),this.commitChanges(),this.clearWarnings(),this.saving=!1}}),this.suppressFlashMessages||this.$e.$emit("flashMessage",{message:this.manager.nameCS+("add"===a?" added.":" saved."),icon:"success"})})).catch((e=>{this.saving=!1,this.error=this.handleError(e)}))):this.viewManager.showView("default",{doNotBlock:!0,afterLeave:()=>{this.revertChanges(),this.clearWarnings(),this.saving=!1}})},handleError:e=>"string"==typeof e?e:"Network Error"===e.message?n.Qj.SERVER_ERROR_NETWORK:e.response&&500===e.response.status?n.Qj.SERVER_ERROR_GENERAL:e.message,isHiddenInForm:(e,t)=>m.utils.access(e.hiddenInForm,t),shouldRenderField(e,t){return"hidden"!==e.type&&!this.isHiddenInForm(e,t)&&(this.adding?!e.editingOnly:!e.addingOnly)},showSaveConf(e){e.onProceed=()=>this.saveItem(!0),e.class=("string"==typeof e.class?e.class+" ":"")+"save-conf",this.viewManager.showConfirmationOverlay(e)},showDeleteConf(){this.viewManager.showConfirmationOverlay({heading:this.activeItem.name?`Delete "${this.activeItem.name}"?`:"Delete?",subheading:"This can't be undone",class:"delete-conf",onProceed:()=>this.deleteItem().then((()=>this.viewManager.showView("default",{doNotBlock:!0})))})},getSaveConfInfo(){let e,t;return this.activeItem.getChanges().forEach((s=>{t=this.fields.find((e=>e.name===s)),t&&t.confirmChange&&(e=t.confirmChange(this.viewManager.activeItem))})),e},showCancelConf(e){this.viewManager.showConfirmationOverlay({heading:"Are you sure you want to cancel?",subheading:"Any changes will be lost.",class:"cancel-conf",onProceed:e})},beforeLeave(e){if(!e)return!this.viewManager.confirmationOverlayActive&&(this.activeItemHasChanges()?new Promise(this.showCancelConf):void 0)}}};s(4172);var p=(0,v.Z)(u,a,[],!1,null,"3db61620",null);p.options.__file="source/addins-vue/shared_components/EditForm.vue";const w=p.exports},4172:(e,t,s)=>{var a=s(3273);"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals),(0,s(5346).Z)("54f2a30d",a,!1,{ssrId:!0})},1685:(e,t,s)=>{var a=s(8102);"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals),(0,s(5346).Z)("1fdb5140",a,!1,{ssrId:!0})}}]);